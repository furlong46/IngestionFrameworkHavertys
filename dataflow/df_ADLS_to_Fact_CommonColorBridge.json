{
	"name": "df_ADLS_to_Fact_CommonColorBridge",
	"properties": {
		"folder": {
			"name": "Fact_DataFlows"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbatrmlu",
						"type": "DatasetReference"
					},
					"name": "SourceTbatrmlu"
				},
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbatrmlv",
						"type": "DatasetReference"
					},
					"name": "SourceTbatrmlv"
				},
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbatrrel",
						"type": "DatasetReference"
					},
					"name": "SourceTbatrrel"
				},
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_Dim_SKU",
						"type": "DatasetReference"
					},
					"name": "SourceSKU"
				},
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_Dim_CommonColor",
						"type": "DatasetReference"
					},
					"name": "SourceCommonColor"
				},
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_Fact_CommonColorBridge",
						"type": "DatasetReference"
					},
					"name": "SouceCommonColorBridge"
				},
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbsoitmatr",
						"type": "DatasetReference"
					},
					"name": "SourceTbsoitmatr"
				},
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbsoadef",
						"type": "DatasetReference"
					},
					"name": "SourceTbsoadef"
				},
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbitem",
						"type": "DatasetReference"
					},
					"name": "SourceTbitem"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_Fact_CommonColorBridge",
						"type": "DatasetReference"
					},
					"name": "SinkCommonColorBridge"
				}
			],
			"transformations": [
				{
					"name": "JoinTbatrmlv"
				},
				{
					"name": "JoinTbatrmlu"
				},
				{
					"name": "FilterTypeID1"
				},
				{
					"name": "SelectTbatrmlv"
				},
				{
					"name": "SelectTbatrmlu"
				},
				{
					"name": "SelectJoinTbatrmlu"
				},
				{
					"name": "LookupCommonColor"
				},
				{
					"name": "SelectSKU"
				},
				{
					"name": "SelectCommonColor"
				},
				{
					"name": "DvClETLETL"
				},
				{
					"name": "JoinSKU"
				},
				{
					"name": "SelectTbatrrel"
				},
				{
					"name": "AggregateDistinctRows"
				},
				{
					"name": "FilterSKU"
				},
				{
					"name": "DeriveCount"
				},
				{
					"name": "WindowRemoveDuplicates"
				},
				{
					"name": "FilterRemoveDuplicates"
				},
				{
					"name": "SelectTbsoitmatr"
				},
				{
					"name": "SelectTbsoadef"
				},
				{
					"name": "DeriveTbsoadef"
				},
				{
					"name": "JoinMatrAdev"
				},
				{
					"name": "DeriveTbatrmlv"
				},
				{
					"name": "JoinAodefMlv"
				},
				{
					"name": "FilterAtrtypid"
				},
				{
					"name": "JoinRrel"
				},
				{
					"name": "JoinTbatrmluSO"
				},
				{
					"name": "SelectSOCommonColors"
				},
				{
					"name": "AggregateSOCommonColors"
				},
				{
					"name": "LookupSOSKUsk"
				},
				{
					"name": "SelectSOwSKUsk"
				},
				{
					"name": "UnionCombineData"
				},
				{
					"name": "DeriveTrimSOSKUs"
				},
				{
					"name": "FilterTbatrmlv"
				},
				{
					"name": "SelectTbitem"
				},
				{
					"name": "JoinItem"
				},
				{
					"name": "LeftJoin"
				}
			],
			"script": "parameters{\n\tMasterProcessNumber as string ('1')\n}\nsource(output(\n\t\tATRID as decimal(38,18),\n\t\tTYPEID as decimal(38,18),\n\t\tVALUE1 as string,\n\t\tVALUE2 as string,\n\t\tSEQ as decimal(38,18),\n\t\tCRTDATE as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp,\n\t\tVALUE3 as string,\n\t\tVALUE4 as string,\n\t\tVALUE5 as string,\n\t\tVALUE6 as string,\n\t\tVALUE7 as string,\n\t\tVALUE8 as string,\n\t\tVALUE9 as string,\n\t\tVALUE10 as string,\n\t\tVALUE11 as string,\n\t\tVALUE12 as string,\n\t\tVALUE13 as string,\n\t\tVALUE14 as string,\n\t\tVALUE15 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbatrmlu\nsource(output(\n\t\tATRID as decimal(38,18),\n\t\tTYPEID as decimal(38,18),\n\t\tVENDOR as string,\n\t\tVALUE1 as string,\n\t\tVALUE2 as string,\n\t\tCRTDATE as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp,\n\t\tVALUE3 as string,\n\t\tSHOWONPAGE as string,\n\t\tVALUE4 as string,\n\t\tVALUE5 as string,\n\t\tLOFTDIFREF as decimal(38,18),\n\t\tLOFTSPECRF as decimal(38,18),\n\t\tLOFTSPECNS as decimal(38,18),\n\t\tFULLRPTIMG as string,\n\t\tFULLRPTHT as decimal(38,18),\n\t\tFULLRPTWD as decimal(38,18),\n\t\tSWATCHHT as decimal(38,18),\n\t\tSWATCHWD as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbatrmlv\nsource(output(\n\t\tMAINATRID as decimal(38,18),\n\t\tRELATRID as decimal(38,18),\n\t\tMAINATRLOC as string,\n\t\tRELATRLOC as string,\n\t\tTYPE as string,\n\t\tSEQ as decimal(38,18),\n\t\tCRTDATE as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp,\n\t\tPRIMARYATR as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbatrrel\nsource(output(\n\t\tSKU_sk as integer,\n\t\tVendor_Color as string,\n\t\tSKU_Unformatted_nk as string,\n\t\tETLBatchID_Insert as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT SKU_sk, Vendor_Color, SKU_Unformatted_nk, ETLBatchID_Insert FROM DW.Dim_SKU',\n\tformat: 'query') ~> SourceSKU\nsource(output(\n\t\tCommon_Color_sk as integer,\n\t\tCommon_Color_Code_nk as integer,\n\t\tCommon_Color_Name as string,\n\t\tHashKey as binary,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SourceCommonColor\nsource(output(\n\t\tCommon_Color_Bridge_sk as integer,\n\t\tCount as integer,\n\t\tSKU_fk as integer,\n\t\tCommon_Color_fk as integer,\n\t\tSKU_Unformatted_nk as string,\n\t\tCommon_Color_Code_nk as integer,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SouceCommonColorBridge\nsource(output(\n\t\tITEM as string,\n\t\tGROUPID as decimal(38,18),\n\t\tPRODID as decimal(38,18),\n\t\tATRTYPID as decimal(38,18),\n\t\tGRADEID as decimal(38,18),\n\t\tATRDEFID as decimal(38,18),\n\t\tCREATED as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbsoitmatr\nsource(output(\n\t\tATRDEFID as decimal(38,18),\n\t\tVENDOR as string,\n\t\tUSERDESC as string,\n\t\tVENDORDESC as string,\n\t\tIMAGE as string,\n\t\tSTATUS as string,\n\t\tGRADEID as decimal(38,18),\n\t\tCREATED as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp,\n\t\tFULLRPTIMG as string,\n\t\tFULLRPTHT as decimal(38,18),\n\t\tFULLRPTWD as decimal(38,18),\n\t\tSWATCHHT as decimal(38,18),\n\t\tSWATCHWD as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbsoadef\nsource(output(\n\t\tITEM as string,\n\t\tVENDOR as string,\n\t\tORIGVND as string,\n\t\tCRTDATE as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp,\n\t\tSTOCKED as string,\n\t\tSKUTYPE as string,\n\t\tRPTCLASS as string,\n\t\tDESC as string,\n\t\tMFGID as string,\n\t\tCOLOR as string,\n\t\tGROUPID as decimal(38,18),\n\t\tWIDTH as decimal(38,18),\n\t\tLENGTH as decimal(38,18),\n\t\tHEIGHT as decimal(38,18),\n\t\tSKUREL as string,\n\t\tPRINTOPT as string,\n\t\tWEIGHT as decimal(38,18),\n\t\tTAXABLE as string,\n\t\tPMAMOUNT as decimal(38,18),\n\t\tTAGDESC as string,\n\t\tSETUPTIME as decimal(38,18),\n\t\tMINPRICE as decimal(38,18),\n\t\tVENDORDEF as string,\n\t\tREORDERPT as decimal(38,18),\n\t\tREORDERQTY as decimal(38,18),\n\t\tSEQUENCE as decimal(38,18),\n\t\tFLOWSTR as timestamp,\n\t\tFLOWEND as timestamp,\n\t\tCUBES as decimal(38,18),\n\t\tPTAGDESCUP as timestamp,\n\t\tHIDEORSHOW as string,\n\t\tWEBDESC as string,\n\t\tPRODID as decimal(38,18),\n\t\tDIRECTSHIP as string,\n\t\tWEBSTATUS as decimal(38,18),\n\t\tINCOMCAT as string,\n\t\tPROTECTION as decimal(38,18),\n\t\tATRID02 as decimal(38,18),\n\t\tATRID03 as decimal(38,18),\n\t\tATRID09 as decimal(38,18),\n\t\tATRID12 as decimal(38,18),\n\t\tALTDLV as string,\n\t\tSHIPWIDTH as decimal(38,18),\n\t\tSHIPLENGTH as decimal(38,18),\n\t\tSHIPHEIGHT as decimal(38,18),\n\t\tPREPCUBES as decimal(38,18),\n\t\tREPORTSKU as string,\n\t\tHTSNUMBER as decimal(38,18),\n\t\tGNRSUBFLG as string,\n\t\tUNTSPERPKG as decimal(38,18),\n\t\tMINORDQTY as decimal(38,18),\n\t\tSTRVWMRKDN as string,\n\t\tFCTSTREAM as decimal(38,18),\n\t\tUPCCODE as decimal(38,18),\n\t\tVNDITEMID as string,\n\t\tADVPRICE as decimal(38,18),\n\t\tSTORESTKD as string,\n\t\tDIAMETER as decimal(38,18),\n\t\tARMHEIGHT as decimal(38,18),\n\t\tSEATHEIGHT as decimal(38,18),\n\t\tSEATDEPTH as decimal(38,18),\n\t\tINSIDEWDTH as decimal(38,18),\n\t\tINSIDEDPTH as decimal(38,18),\n\t\tLINEUPSTAT as string,\n\t\tITEMTYPE as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbitem\nJoinItem, SelectTbatrrel join(ATRID == MAINATRID,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> JoinTbatrmlv\nJoinTbatrmlv, SelectTbatrmlu join(RELATRID == SelectTbatrmlu@ATRID,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> JoinTbatrmlu\nSourceTbatrmlu filter(TYPEID==1) ~> FilterTypeID1\nFilterTbatrmlv select(mapColumn(\n\t\tATRID,\n\t\tTYPEID,\n\t\tVENDOR,\n\t\tVendorColor = VALUE1,\n\t\tVALUE2\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectTbatrmlv\nFilterTypeID1 select(mapColumn(\n\t\tATRID,\n\t\tTYPEID,\n\t\tCommonColor = VALUE1\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectTbatrmlu\nJoinTbatrmlu select(mapColumn(\n\t\tVendorColor = VALUE1,\n\t\tCommonColor,\n\t\tITEM,\n\t\tATRID = SelectTbatrmlu@ATRID\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectJoinTbatrmlu\nDeriveCount, SourceCommonColor lookup(ATRID == Common_Color_Code_nk,\n\tmultiple: true,\n\tbroadcast: 'none')~> LookupCommonColor\nJoinSKU select(mapColumn(\n\t\tVendorColor,\n\t\tCommonColor,\n\t\tSKU_sk,\n\t\tSKU_Unformatted_nk,\n\t\tATRID\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectSKU\nLookupCommonColor select(mapColumn(\n\t\tCount,\n\t\tSKU_sk = SourceSKU@SKU_sk,\n\t\tSKU_Unformatted_nk = SourceSKU@SKU_Unformatted_nk,\n\t\tCommon_Color_sk,\n\t\tCommon_Color_Code_nk,\n\t\tATRID\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectCommonColor\nSelectCommonColor derive(ETLBatchID_Insert = toInteger($MasterProcessNumber),\n\t\tETLBatchID_Update = toInteger($MasterProcessNumber),\n\t\tSourceSystem_fk = 0,\n\t\tCommon_Color_fk = case(isNull(ATRID), -1, isNull(Common_Color_sk) && not(isNull(ATRID)), 0, Common_Color_sk),\n\t\tSKU_fk = iifNull(SKU_sk, 0),\n\t\tCommon_Color_Code_nk = case(isNull(ATRID), -1, isNull(Common_Color_Code_nk) && not(isNull(ATRID)), 0, Common_Color_Code_nk),\n\t\tSKU_Unformatted_nk = iifNull(SKU_Unformatted_nk, '')) ~> DvClETLETL\nAggregateDistinctRows, SourceSKU join(ITEM == SKU_Unformatted_nk,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> JoinSKU\nSourceTbatrrel select(mapColumn(\n\t\tMAINATRID,\n\t\tRELATRID\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectTbatrrel\nSelectJoinTbatrmlu aggregate(groupBy(VendorColor,\n\t\tCommonColor,\n\t\tITEM,\n\t\tATRID),\n\tGroupCount = sum(1)) ~> AggregateDistinctRows\nSourceSKU filter(Vendor_Color!='') ~> FilterSKU\nLeftJoin derive(Count = 1) ~> DeriveCount\nDvClETLETL window(over(SKU_Unformatted_nk,\n\t\tCommon_Color_Code_nk),\n\tasc(SKU_Unformatted_nk, true),\n\tasc(Common_Color_Code_nk, true),\n\tDupeRows = rowNumber()) ~> WindowRemoveDuplicates\nWindowRemoveDuplicates filter(DupeRows==1) ~> FilterRemoveDuplicates\nSourceTbsoitmatr select(mapColumn(\n\t\tITEM,\n\t\tATRTYPID,\n\t\tATRDEFID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectTbsoitmatr\nSourceTbsoadef select(mapColumn(\n\t\tATRDEFID,\n\t\tIMAGE\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectTbsoadef\nSelectTbsoadef derive(IMAGE = trim(IMAGE)) ~> DeriveTbsoadef\nFilterAtrtypid, DeriveTbsoadef join(SelectTbsoitmatr@ATRDEFID == SelectTbsoadef@ATRDEFID,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> JoinMatrAdev\nSelectTbatrmlv derive(VALUE2 = trim(VALUE2)) ~> DeriveTbatrmlv\nJoinMatrAdev, DeriveTbatrmlv join(IMAGE == VALUE2,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> JoinAodefMlv\nSelectTbsoitmatr filter(ATRTYPID == 255 || ATRTYPID == 291) ~> FilterAtrtypid\nJoinAodefMlv, SelectTbatrrel join(ATRID == MAINATRID,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> JoinRrel\nJoinRrel, SelectTbatrmlu join(RELATRID == SelectTbatrmlu@ATRID,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> JoinTbatrmluSO\nJoinTbatrmluSO select(mapColumn(\n\t\tSKU_Unformatted_nk = ITEM,\n\t\tVendorColor,\n\t\tCommonColor,\n\t\tATRID = SelectTbatrmlu@ATRID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectSOCommonColors\nSelectSOCommonColors aggregate(groupBy(VendorColor,\n\t\tCommonColor,\n\t\tSKU_Unformatted_nk,\n\t\tATRID),\n\tSOCount = sum(1)) ~> AggregateSOCommonColors\nAggregateSOCommonColors, SourceSKU lookup(AggregateSOCommonColors@SKU_Unformatted_nk == SourceSKU@SKU_Unformatted_nk,\n\tmultiple: true,\n\tbroadcast: 'none')~> LookupSOSKUsk\nLookupSOSKUsk select(mapColumn(\n\t\tVendorColor,\n\t\tCommonColor,\n\t\tSKU_Unformatted_nk = AggregateSOCommonColors@SKU_Unformatted_nk,\n\t\tSKU_sk,\n\t\tATRID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectSOwSKUsk\nSelectSKU, DeriveTrimSOSKUs union(byName: true)~> UnionCombineData\nSelectSOwSKUsk derive(VendorColor = trim(VendorColor),\n\t\tCommonColor = trim(CommonColor)) ~> DeriveTrimSOSKUs\nSourceTbatrmlv filter(TYPEID ==2) ~> FilterTbatrmlv\nSourceTbitem select(mapColumn(\n\t\tITEM,\n\t\tATRID02\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectTbitem\nSelectTbitem, SourceTbatrmlv join(ATRID02 == ATRID,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> JoinItem\nSourceSKU, UnionCombineData join(SourceSKU@SKU_Unformatted_nk == UnionCombineData@SKU_Unformatted_nk,\n\tjoinType:'left',\n\tbroadcast: 'none')~> LeftJoin\nFilterRemoveDuplicates sink(input(\n\t\tCommon_Color_Bridge_sk as integer,\n\t\tCount as integer,\n\t\tSKU_fk as integer,\n\t\tCommon_Color_fk as integer,\n\t\tSKU_Unformatted_nk as string,\n\t\tCommon_Color_Code_nk as integer,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\ttruncate:true,\n\tformat: 'table',\n\tmapColumn(\n\t\tCount,\n\t\tSKU_fk,\n\t\tCommon_Color_fk,\n\t\tSKU_Unformatted_nk,\n\t\tCommon_Color_Code_nk,\n\t\tSourceSystem_fk,\n\t\tETLBatchID_Insert,\n\t\tETLBatchID_Update\n\t)) ~> SinkCommonColorBridge"
		}
	}
}