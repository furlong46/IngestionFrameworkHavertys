{
	"name": "df_ADLS_to_Fact_SpecialOrderAttributesKeyValuesBridge",
	"properties": {
		"folder": {
			"name": "Fact_DataFlows"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbsoitmatr",
						"type": "DatasetReference"
					},
					"name": "SourceTbsoitmatr"
				},
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbsoatyp",
						"type": "DatasetReference"
					},
					"name": "SourceTbsoatyp"
				},
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbsogdef",
						"type": "DatasetReference"
					},
					"name": "SourceTbsogdef"
				},
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbsoadef",
						"type": "DatasetReference"
					},
					"name": "SourceTbsoadef"
				},
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_Dim_SKU",
						"type": "DatasetReference"
					},
					"name": "SourceSKU"
				},
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_Dim_SpecialOrderAttributesKey",
						"type": "DatasetReference"
					},
					"name": "SourceSpecialOrderAttributeKey"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ds_AzureSQLTable_Fact_SpecialOrderAttributesKeyValueBridge",
						"type": "DatasetReference"
					},
					"name": "SinkSOAKeyValueBridge"
				}
			],
			"transformations": [
				{
					"name": "JoinInnterTbsoatyp"
				},
				{
					"name": "JoinTbsogdef"
				},
				{
					"name": "JoinTbsoadef"
				},
				{
					"name": "SelectfromJoins"
				},
				{
					"name": "LookupSKU"
				},
				{
					"name": "SelectSKU"
				},
				{
					"name": "LookupSOAttributeKey"
				},
				{
					"name": "Select1"
				},
				{
					"name": "DerivedColumn1"
				},
				{
					"name": "WindowRemoveDuplicates"
				},
				{
					"name": "FilterRemoveDuplicates"
				}
			],
			"script": "\nparameters{\n\tMasterProcessNumber as string ('1')\n}\nsource(output(\n\t\tITEM as string,\n\t\tGROUPID as decimal(38,18),\n\t\tPRODID as decimal(38,18),\n\t\tATRTYPID as decimal(38,18),\n\t\tGRADEID as decimal(38,18),\n\t\tATRDEFID as decimal(38,18),\n\t\tCREATED as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbsoitmatr\nsource(output(\n\t\tATRTYPID as decimal(38,18),\n\t\tATTRIBUTE as string,\n\t\tCREATED as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbsoatyp\nsource(output(\n\t\tGRADEID as decimal(38,18),\n\t\tVENDOR as string,\n\t\tDESC as string,\n\t\tCREATED as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbsogdef\nsource(output(\n\t\tATRDEFID as decimal(38,18),\n\t\tVENDOR as string,\n\t\tUSERDESC as string,\n\t\tVENDORDESC as string,\n\t\tIMAGE as string,\n\t\tSTATUS as string,\n\t\tGRADEID as decimal(38,18),\n\t\tCREATED as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp,\n\t\tFULLRPTIMG as string,\n\t\tFULLRPTHT as decimal(38,18),\n\t\tFULLRPTWD as decimal(38,18),\n\t\tSWATCHHT as decimal(38,18),\n\t\tSWATCHWD as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbsoadef\nsource(output(\n\t\tSKU_sk as integer,\n\t\tSKU_Unformatted_nk as string,\n\t\tSKU as string,\n\t\tSKU_Description as string,\n\t\tVendor_Color_ID as integer,\n\t\tVendor_Color as string,\n\t\tVendor_Color_Hex_Code as string,\n\t\tVendor_Finish_ID as integer,\n\t\tVendor_Finish as string,\n\t\tConfiguration_ID as integer,\n\t\tConfiguration as string,\n\t\tDisplay_Configuration as string,\n\t\tSize_ID as integer,\n\t\tSize as string,\n\t\tOriginal_Vendor_ID as string,\n\t\tOriginal_Vendor_sk as integer,\n\t\tCollection_ID as integer,\n\t\tCollection as string,\n\t\tGroup_ID as integer,\n\t\tGroup as string,\n\t\tProduct_ID as integer,\n\t\tProduct as string,\n\t\tReporting_Class_Code as string,\n\t\tReporting_Class as string,\n\t\tSuper_Category_ID as integer,\n\t\tSuper_Category as string,\n\t\tCategory_ID as integer,\n\t\tCategory as string,\n\t\tSub_Category_ID as integer,\n\t\tSub_Category as string,\n\t\tCurrent_EDLP_Price as decimal(10,4),\n\t\tGood_Better_Best_Category as string,\n\t\tGBB_Price_Point as string,\n\t\tMotion as string,\n\t\tDining_Style as string,\n\t\tBedroom_Style as string,\n\t\tStandalone_bed as string,\n\t\tSKU_Type as string,\n\t\tStocked as string,\n\t\tType_of_SKU as string,\n\t\tVendor as string,\n\t\tVendor_fk as integer,\n\t\tFactory as string,\n\t\tFactory_fk as integer,\n\t\tSpecial_Order_Available as string,\n\t\tVendor_Lead_Time as integer,\n\t\tProduct_Lead_Time as integer,\n\t\tGroup_Active_Start as date,\n\t\tGroup_Active_End as date,\n\t\tSKU_Flow_StartDate as date,\n\t\tSKU_Flow_EndDate as date,\n\t\tStocked_at_EDC as integer,\n\t\tStocked_at_WDC as integer,\n\t\tStocked_at_FDC as integer,\n\t\tGroup_Web_Status as integer,\n\t\tSKU_Web_Status as integer,\n\t\tMerchandising_Approval as string,\n\t\tMarketing_Approval as string,\n\t\tLineup_Status as string,\n\t\tAvailable_to_Purchase as string,\n\t\tShip_Length as integer,\n\t\tShip_Width as integer,\n\t\tShip_Height as integer,\n\t\tLength as integer,\n\t\tWidth as integer,\n\t\tHeight as integer,\n\t\tWeight as decimal(5,1),\n\t\tPrep_Cubes as decimal(5,1),\n\t\tCubes as decimal(5,1),\n\t\tPrep_Flag as string,\n\t\tAssembly_Required as string,\n\t\tAssembly_Time as decimal(4,1),\n\t\tLeave_in_Box as string,\n\t\tManufacturer_ID as string,\n\t\tUPC as long,\n\t\tHTS_Number as long,\n\t\tOriginal_SKU as string,\n\t\tRepresentative_Item as string,\n\t\tGroup_Rating_Count as integer,\n\t\tProduct_Rating_Count as integer,\n\t\tGroup_Star_Rating as decimal(6,4),\n\t\tProduct_Star_Rating as decimal(6,4),\n\t\tMade_in_ID as integer,\n\t\tMade_in_City as string,\n\t\tMade_in_State as string,\n\t\tMade_in_Country as string,\n\t\tOrigin_ID as integer,\n\t\tOrigin_City as string,\n\t\tOrigin_State as string,\n\t\tOrigin_Country as string,\n\t\tCopy as string,\n\t\tWeb_Description as string,\n\t\tPrice_Tag_Description as string,\n\t\tPrimary_Common_Color as string,\n\t\tPrimary_Common_Finish as string,\n\t\tFloor_Sample_Bedding as string,\n\t\tEmployee_Bedding as string,\n\t\tAccessory_Story as string,\n\t\t{3D_Model_Required} as string,\n\t\t{3D_Model} as string,\n\t\tScene_7_Image_URL as string,\n\t\t{Havertys.com_URL} as string,\n\t\tAdvertised_Price as decimal(7,2),\n\t\tHashKey as string,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SourceSKU\nsource(output(\n\t\tSpecial_Order_Attributes_Key_sk as integer,\n\t\tAttribute_Type_ID_nk as integer,\n\t\tAttribute as string,\n\t\tAttribute_Group as string,\n\t\tHashKey as string,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SourceSpecialOrderAttributeKey\nSourceTbsoitmatr, SourceTbsoatyp join(SourceTbsoitmatr@ATRTYPID == SourceTbsoatyp@ATRTYPID,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> JoinInnterTbsoatyp\nJoinInnterTbsoatyp, SourceTbsogdef join(SourceTbsoitmatr@GRADEID == SourceTbsogdef@GRADEID,\n\tjoinType:'left',\n\tbroadcast: 'none')~> JoinTbsogdef\nJoinTbsogdef, SourceTbsoadef join(SourceTbsoitmatr@ATRDEFID == SourceTbsoadef@ATRDEFID,\n\tjoinType:'left',\n\tbroadcast: 'none')~> JoinTbsoadef\nJoinTbsoadef select(mapColumn(\n\t\tItem_fk = ITEM,\n\t\tSpecial_Order_Attributes_Key_Values_fk = {SourceTbsoitmatr@ATRTYPID},\n\t\tGRADEID = {SourceTbsoitmatr@GRADEID},\n\t\tATRDEFID = {SourceTbsoitmatr@ATRDEFID},\n\t\tATTRIBUTE,\n\t\tGrade_Value = {SourceTbsoitmatr@GRADEID},\n\t\tAttribute_Value = USERDESC,\n\t\tVendor_Value = VENDORDESC\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectfromJoins\nSelectfromJoins, SelectSKU lookup(Item_fk == SKU_Unformatted_nk,\n\tbroadcast: 'none')~> LookupSKU\nSourceSKU select(mapColumn(\n\t\tSKU_sk,\n\t\tSKU_Unformatted_nk\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectSKU\nLookupSKU, SourceSpecialOrderAttributeKey lookup(Special_Order_Attributes_Key_Values_fk == Attribute_Type_ID_nk,\n\tbroadcast: 'none')~> LookupSOAttributeKey\nLookupSOAttributeKey select(mapColumn(\n\t\tItem_fk,\n\t\tSpecial_Order_Attributes_Key_Values_fk,\n\t\tGrade_Value,\n\t\tSKU_sk,\n\t\tSKU_Unformatted_nk,\n\t\tSpecial_Order_Attributes_Key_sk,\n\t\tAttribute_Type_ID_nk,\n\t\tAttribute = {SourceSpecialOrderAttributeKey@Attribute},\n\t\tAttribute_Group,\n\t\tAttribute_Value,\n\t\tVendor_Value\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> Select1\nSelect1 derive(ETLBatchID_Insert = toInteger($MasterProcessNumber),\n\t\tETLBatchID_Update = toInteger($MasterProcessNumber),\n\t\tSourceSystem_fk = 0,\n\t\tItem_fk = iifNull(Item_fk, 'Failed Lookup'),\n\t\tSpecial_Order_Attributes_Key_Values_fk = iifNull(Special_Order_Attributes_Key_Values_fk, 0),\n\t\tGrade_Value = iifNull(toInteger(Grade_Value), 0),\n\t\tSKU_Unformatted_nk = iifNull(SKU_Unformatted_nk, 'Failed Lookup'),\n\t\tSKU_sk = iifNull(SKU_sk, 0),\n\t\tAttribute_Type_ID_nk = iifNull(Attribute_Type_ID_nk, 0),\n\t\tAttribute = iifNull(Attribute, 'Failed Lookup'),\n\t\tAttribute_Group = iifNull(Attribute_Group, '')) ~> DerivedColumn1\nDerivedColumn1 window(over(SKU_Unformatted_nk = SKU_Unformatted_nk,\n\t\tAttribute_Type_ID_nk = Attribute_Type_ID_nk),\n\tasc(SKU_Unformatted_nk, true),\n\tasc(Attribute_Type_ID_nk, true),\n\tDupeCount = rowNumber()) ~> WindowRemoveDuplicates\nWindowRemoveDuplicates filter(DupeCount==1) ~> FilterRemoveDuplicates\nFilterRemoveDuplicates sink(input(\n\t\tSpecial_Order_Attributes_Key_Values_Bridge_sk as integer,\n\t\tAttribute_Value as string,\n\t\tVendor_Value as string,\n\t\tGrade_Value as string,\n\t\tSpecial_Order_Attributes_Key_fk as integer,\n\t\tSKU_fk as integer,\n\t\tAttribute as string,\n\t\tAttribute_Group as string,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\ttruncate:true,\n\tformat: 'table',\n\tmapColumn(\n\t\tAttribute_Value,\n\t\tVendor_Value,\n\t\tGrade_Value,\n\t\tSpecial_Order_Attributes_Key_fk = Special_Order_Attributes_Key_sk,\n\t\tSKU_fk = SKU_sk,\n\t\tAttribute,\n\t\tAttribute_Group,\n\t\tSourceSystem_fk,\n\t\tETLBatchID_Insert,\n\t\tETLBatchID_Update\n\t)) ~> SinkSOAKeyValueBridge"
		}
	}
}