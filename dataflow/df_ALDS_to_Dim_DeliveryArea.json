{
	"name": "df_ALDS_to_Dim_DeliveryArea",
	"properties": {
		"folder": {
			"name": "Dim_DataFlows"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_deliveryarea_pcpmtblda",
						"type": "DatasetReference"
					},
					"name": "SourceADLSpcpmtblda"
				},
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_DW_DimLocation",
						"type": "DatasetReference"
					},
					"name": "SourceDimLocation"
				},
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_Dim_DeliveryArea",
						"type": "DatasetReference"
					},
					"name": "SourceDimDeliveryArea"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_Dim_DeliveryArea",
						"type": "DatasetReference"
					},
					"name": "DimDeliveryArea"
				}
			],
			"transformations": [
				{
					"name": "SelectPcpmtblda"
				},
				{
					"name": "DVClPcpmtblda",
					"description": "Autogenerated by data preview actions"
				},
				{
					"name": "DvClDimLocation"
				},
				{
					"name": "SelectDimLocation"
				},
				{
					"name": "DvClDeliveringDC"
				},
				{
					"name": "SelectPcpmtblda2"
				},
				{
					"name": "DvClDropOff"
				},
				{
					"name": "SelectPcpmtblda3"
				},
				{
					"name": "DvClServiceTech"
				},
				{
					"name": "SelectPcpmtblda4"
				},
				{
					"name": "DvClCustomerPickupMarket"
				},
				{
					"name": "SelectPcpmtblda5"
				},
				{
					"name": "DvCelHash"
				},
				{
					"name": "DvClNullTrim"
				},
				{
					"name": "SelectDimDeliveryArea"
				},
				{
					"name": "LuDimDeliveryArea"
				},
				{
					"name": "LuSelectDimLocation1"
				},
				{
					"name": "LuSelectDimLocation2"
				},
				{
					"name": "LuSelectDimLocation3"
				},
				{
					"name": "LuSelectDimLocation4"
				},
				{
					"name": "AltRowUpdateOrInsert"
				},
				{
					"name": "DvClNullFix"
				},
				{
					"name": "WinRemoveDup"
				},
				{
					"name": "FilterRemoveDup"
				},
				{
					"name": "FilterUpdates"
				},
				{
					"name": "DvClETLBatchInsert"
				}
			],
			"script": "parameters{\n\tMasterProcessNumber as integer (1)\n}\nsource(output(\n\t\tTBLDANUM as decimal(38,18),\n\t\tTBLDADLDC as decimal(38,18),\n\t\tTBLDATYPE as string,\n\t\tTBLDADOPC as decimal(38,18),\n\t\tTBLDADOBR as decimal(38,18),\n\t\tTBLDAABRV as string,\n\t\tTBLDANAME as string,\n\t\tTBLDASTPC as decimal(38,18),\n\t\tTBLDASTBR as decimal(38,18),\n\t\tTBLDACPU as decimal(38,18),\n\t\tTBLDAACTDT as decimal(38,18),\n\t\tTBLDAFLYBZ as string,\n\t\tTBLDARPP01 as decimal(38,18),\n\t\tTBLDARPP02 as decimal(38,18),\n\t\tTBLDARPP03 as decimal(38,18),\n\t\tTBLDARPP04 as decimal(38,18),\n\t\tTBLDARPP05 as decimal(38,18),\n\t\tTBLDARPP06 as decimal(38,18),\n\t\tTBLDARPP07 as decimal(38,18),\n\t\tTBLDARPP08 as decimal(38,18),\n\t\tTBLDARPP09 as decimal(38,18),\n\t\tTBLDARPP10 as decimal(38,18),\n\t\tTBLDARPP11 as decimal(38,18),\n\t\tTBLDARPP12 as decimal(38,18),\n\t\tTBLDARPP13 as decimal(38,18),\n\t\tTBLDARPP14 as decimal(38,18),\n\t\tTBLDARPP15 as decimal(38,18),\n\t\tTBLDARPP16 as decimal(38,18),\n\t\tTBLDARPP17 as decimal(38,18),\n\t\tTBLDARPP18 as decimal(38,18),\n\t\tTBLDARPP19 as decimal(38,18),\n\t\tTBLDARPP20 as decimal(38,18),\n\t\tTBLDARPP21 as decimal(38,18),\n\t\tTBLDARPP22 as decimal(38,18),\n\t\tTBLDARPP23 as decimal(38,18),\n\t\tTBLDARPP24 as decimal(38,18),\n\t\tTBLDARPP25 as decimal(38,18),\n\t\tTBLDAOBCFG as string,\n\t\tTBLDADLVTW as decimal(38,18),\n\t\tTBLDAMAXTW as decimal(38,18),\n\t\tTBLDAEPUP as decimal(38,18),\n\t\tTBLDAIVRTY as string,\n\t\tTBLDACSPCF as string,\n\t\tTBLDAAPXFF as string,\n\t\tTBLDAATWF as string,\n\t\tTBLDARTGID as decimal(38,18),\n\t\tTBLDADRVGP as decimal(38,18),\n\t\tTBLDABCAGE as decimal(38,18),\n\t\tTBLDAMTWIN as decimal(38,18),\n\t\tTBLDABSTIM as decimal(38,18),\n\t\tTBLDAPULLP as decimal(38,18),\n\t\tTBLDADSPF as string,\n\t\tTBLDAONMOB as string,\n\t\tTBLDAHRWDY as decimal(38,18),\n\t\tTBLDAFILL as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceADLSpcpmtblda\nsource(output(\n\t\tLocation_sk as integer,\n\t\tLocation_Code_nk as string,\n\t\tDivision_ID as integer,\n\t\tDivision as string,\n\t\tRegion_ID as string,\n\t\tRegion as string,\n\t\tMarket_Code as integer,\n\t\tMarket_ID as integer,\n\t\tMarket as string,\n\t\tLocation_ID as integer,\n\t\tLocation_Name as string,\n\t\tLocation_Sales_Manager as string,\n\t\tMarket_Manager as string,\n\t\tLabel as string,\n\t\tBranch_Type as string,\n\t\tLocation_Type as string,\n\t\tPhone_Number as decimal(10,0),\n\t\tAddress_1 as string,\n\t\tAddress_2 as string,\n\t\tCity as string,\n\t\tState as string,\n\t\tCountry as string,\n\t\tZip as string,\n\t\tZip4 as string,\n\t\tMarket_Zip as string,\n\t\tLongitude as decimal(16,13),\n\t\tLatitude as decimal(16,13),\n\t\tBranch_Announced_Date as date,\n\t\tBranch_Shut_Down_Date as date,\n\t\tActive as string,\n\t\tTotal_Square_Feet as decimal(10,4),\n\t\tTotal_Sales_Square_Feet as decimal(10,4),\n\t\tSales_Conditioned_CC_Square_Feet as decimal(10,4),\n\t\tSales_Square_Feet as decimal(10,4),\n\t\tWarehouse_Square_Feet as decimal(10,4),\n\t\tOffice_Utility_Square_Feet as decimal(10,4),\n\t\tAdmin_Flag as string,\n\t\tSize as string,\n\t\tTime_Zone as string,\n\t\tAccounting_Unit as string,\n\t\tBranch_Open_Date as date,\n\t\tBranch_Close_Date as date,\n\t\tHashKey as string,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SourceDimLocation\nsource(output(\n\t\tDelivery_Area_sk as integer,\n\t\tDelivery_Area_ID_nk as integer,\n\t\tDelivery_Area_Type_Code as string,\n\t\tDelivery_Area_Type as string,\n\t\tDelivery_Area_Short_Name as string,\n\t\tDelivery_Area_Name as string,\n\t\tDelivering_DC_ID as integer,\n\t\tDelivering_DC as string,\n\t\tDrop_Off_Market_ID as integer,\n\t\tDrop_Off_Market as string,\n\t\tDrop_Off_Location_ID as integer,\n\t\tDrop_Off_Location as string,\n\t\tSerivce_Tech_Market_ID as integer,\n\t\tSerivce_Tech_Market as string,\n\t\tService_Tech_Location_ID as integer,\n\t\tService_Tech_Location as string,\n\t\tCustomer_Pickup_Market_ID as integer,\n\t\tCustomer_Pickup_Market as string,\n\t\tActive_Date as date,\n\t\tDelivery_Area_Status as string,\n\t\tHashKey as string,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SourceDimDeliveryArea\nSourceADLSpcpmtblda select(mapColumn(\n\t\tDelivery_Area_ID_nk = TBLDANUM,\n\t\tDelivering_DC_ID = TBLDADLDC,\n\t\tDelivery_Area_Type_Code = TBLDATYPE,\n\t\tDelivery_Area_Short_Name = TBLDAABRV,\n\t\tDelivery_Area_Name = TBLDANAME,\n\t\tDrop_Off_Market_ID = TBLDADOPC,\n\t\tDrop_Off_Location_ID = TBLDADOBR,\n\t\tService_Tech_Location_ID = TBLDASTBR,\n\t\tService_Tech_Market_ID = TBLDASTPC,\n\t\tCustomer_Pickup_Market_ID = TBLDACPU,\n\t\tActive_Date = TBLDAACTDT,\n\t\tDelivery_Area_Status = TBLDADSPF\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectPcpmtblda\nSelectPcpmtblda derive(Delivery_Area_ID_nk = toInteger(Delivery_Area_ID_nk),\n\t\tDelivering_DC_ID = toInteger(Delivering_DC_ID),\n\t\tDrop_Off_Market_ID = toInteger(Drop_Off_Market_ID),\n\t\tDrop_Off_Location_ID = toInteger(Drop_Off_Location_ID),\n\t\tService_Tech_Market_ID = toInteger(Service_Tech_Market_ID),\n\t\tService_Tech_Location_ID = toInteger(Service_Tech_Location_ID),\n\t\tCustomer_Pickup_Market_ID = toInteger(Customer_Pickup_Market_ID),\n\t\tActive_Date = toDate(toString(toInteger(Active_Date)),\"YYYYMMdd\"),\n\t\tDelivery_Area_Type = iif(equalsIgnoreCase(Delivery_Area_Type_Code,'H'), 'Home Delivery', iif(equalsIgnoreCase(Delivery_Area_Type_Code,'D'), 'Drop Off', iif(equalsIgnoreCase(Delivery_Area_Type_Code,'A'), 'Alternate Delivery', '')))) ~> DVClPcpmtblda\nSourceDimLocation derive(MarketInt = Division_ID*1000 + Market_Code) ~> DvClDimLocation\nDvClDimLocation select(mapColumn(\n\t\tMarketInt,\n\t\tLocation_Name,\n\t\tLocation_ID,\n\t\tMarket\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectDimLocation\nLuSelectDimLocation1 derive(Delivering_DC = Market) ~> DvClDeliveringDC\nDvClDeliveringDC select(mapColumn(\n\t\tDelivery_Area_ID_nk,\n\t\tDelivering_DC_ID,\n\t\tDelivery_Area_Type_Code,\n\t\tDelivery_Area_Short_Name,\n\t\tDelivery_Area_Name,\n\t\tDrop_Off_Market_ID,\n\t\tDrop_Off_Location_ID,\n\t\tService_Tech_Location_ID,\n\t\tService_Tech_Market_ID,\n\t\tCustomer_Pickup_Market_ID,\n\t\tActive_Date,\n\t\tDelivery_Area_Status,\n\t\tDelivery_Area_Type,\n\t\tDelivering_DC\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectPcpmtblda2\nLuSelectDimLocation2 derive(Drop_Off_Location = Location_Name,\n\t\tDrop_Off_Market = Market) ~> DvClDropOff\nDvClDropOff select(mapColumn(\n\t\tDelivery_Area_ID_nk,\n\t\tDelivering_DC_ID,\n\t\tDelivery_Area_Type_Code,\n\t\tDelivery_Area_Short_Name,\n\t\tDelivery_Area_Name,\n\t\tDrop_Off_Market_ID,\n\t\tDrop_Off_Location_ID,\n\t\tService_Tech_Location_ID,\n\t\tService_Tech_Market_ID,\n\t\tCustomer_Pickup_Market_ID,\n\t\tActive_Date,\n\t\tDelivery_Area_Status,\n\t\tDelivery_Area_Type,\n\t\tDelivering_DC,\n\t\tDrop_Off_Market,\n\t\tDrop_Off_Location\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectPcpmtblda3\nLuSelectDimLocation3 derive(Service_Tech_Market = Market,\n\t\tService_Tech_Location = Location_Name) ~> DvClServiceTech\nDvClServiceTech select(mapColumn(\n\t\tDelivery_Area_ID_nk,\n\t\tDelivering_DC_ID,\n\t\tDelivery_Area_Type_Code,\n\t\tDelivery_Area_Short_Name,\n\t\tDelivery_Area_Name,\n\t\tDrop_Off_Market_ID,\n\t\tDrop_Off_Location_ID,\n\t\tService_Tech_Location_ID,\n\t\tService_Tech_Market_ID,\n\t\tCustomer_Pickup_Market_ID,\n\t\tActive_Date,\n\t\tDelivery_Area_Status,\n\t\tDelivery_Area_Type,\n\t\tDelivering_DC,\n\t\tDrop_Off_Market,\n\t\tDrop_Off_Location,\n\t\tService_Tech_Market,\n\t\tService_Tech_Location\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectPcpmtblda4\nLuSelectDimLocation4 derive(Customer_Pickup_Market = Market) ~> DvClCustomerPickupMarket\nDvClCustomerPickupMarket select(mapColumn(\n\t\tDelivery_Area_ID_nk,\n\t\tDelivering_DC_ID,\n\t\tDelivery_Area_Type_Code,\n\t\tDelivery_Area_Short_Name,\n\t\tDelivery_Area_Name,\n\t\tDrop_Off_Market_ID,\n\t\tDrop_Off_Location_ID,\n\t\tService_Tech_Location_ID,\n\t\tService_Tech_Market_ID,\n\t\tCustomer_Pickup_Market_ID,\n\t\tActive_Date,\n\t\tDelivery_Area_Status,\n\t\tDelivery_Area_Type,\n\t\tDelivering_DC,\n\t\tDrop_Off_Market,\n\t\tDrop_Off_Location,\n\t\tService_Tech_Market,\n\t\tService_Tech_Location,\n\t\tCustomer_Pickup_Market\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectPcpmtblda5\nDvClNullFix derive(HashKey = sha1(Delivery_Area_ID_nk,Delivering_DC_ID,Delivery_Area_Type_Code,Delivery_Area_Short_Name,Delivery_Area_Name,Drop_Off_Market_ID,Drop_Off_Location_ID,Service_Tech_Location_ID,Service_Tech_Market_ID,Customer_Pickup_Market_ID,Active_Date,Delivery_Area_Status,Delivery_Area_Type,Delivering_DC,Drop_Off_Market,Drop_Off_Location,Service_Tech_Market,Service_Tech_Location,Customer_Pickup_Market),\n\t\tSourceSystem_fk = 0,\n\t\tETLBatchID_Update = toInteger($MasterProcessNumber)) ~> DvCelHash\nDVClPcpmtblda derive(each(match(type=='string'), $$ = iifNull(trim($$), ''))) ~> DvClNullTrim\nSourceDimDeliveryArea select(mapColumn(\n\t\tDelivery_Area_ID_nk_dim = Delivery_Area_ID_nk,\n\t\tHashKey_dim = HashKey,\n\t\tDelivery_Area_sk_dim = Delivery_Area_sk,\n\t\tETLBatchID_Insert_dim = ETLBatchID_Insert\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectDimDeliveryArea\nDvCelHash, SelectDimDeliveryArea lookup(Delivery_Area_ID_nk == Delivery_Area_ID_nk_dim,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'none')~> LuDimDeliveryArea\nDvClNullTrim, SelectDimLocation lookup(Delivering_DC_ID == MarketInt,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'none')~> LuSelectDimLocation1\nSelectPcpmtblda2, SelectDimLocation lookup(Drop_Off_Market_ID == MarketInt,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'none')~> LuSelectDimLocation2\nSelectPcpmtblda3, SelectDimLocation lookup(Service_Tech_Market_ID == MarketInt\n\t&& Service_Tech_Location_ID == Location_ID,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'none')~> LuSelectDimLocation3\nSelectPcpmtblda4, SelectDimLocation lookup(Customer_Pickup_Market_ID == MarketInt,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'none')~> LuSelectDimLocation4\nFilterUpdates alterRow(insertIf(isNull(Delivery_Area_ID_nk_dim)),\n\tupdateIf(!isNull(HashKey_dim)&&(HashKey!=HashKey_dim))) ~> AltRowUpdateOrInsert\nSelectPcpmtblda5 derive(each(match(type=='string'), $$ = iifNull(trim($$), '')),\n\t\teach(match(type=='date'), $$ = iifNull($$, toDate('1900-01-01')))) ~> DvClNullFix\nDvClETLBatchInsert window(over(Delivery_Area_ID_nk),\n\tasc(Delivery_Area_ID_nk, true),\n\tRowCount = rowNumber()) ~> WinRemoveDup\nWinRemoveDup filter(RowCount == 1) ~> FilterRemoveDup\nFilterRemoveDup filter(isNull(Delivery_Area_ID_nk_dim) || (!isNull(Delivery_Area_sk_dim) && HashKey != HashKey_dim)) ~> FilterUpdates\nLuDimDeliveryArea derive(ETLBatchID_Insert = iifNull(ETLBatchID_Insert_dim, toInteger($MasterProcessNumber))) ~> DvClETLBatchInsert\nAltRowUpdateOrInsert sink(input(\n\t\tDelivery_Area_sk as integer,\n\t\tDelivery_Area_ID_nk as integer,\n\t\tDelivery_Area_Type_Code as string,\n\t\tDelivery_Area_Type as string,\n\t\tDelivery_Area_Short_Name as string,\n\t\tDelivery_Area_Name as string,\n\t\tDelivering_DC_ID as integer,\n\t\tDelivering_DC as string,\n\t\tDrop_Off_Market_ID as integer,\n\t\tDrop_Off_Market as string,\n\t\tDrop_Off_Location_ID as integer,\n\t\tDrop_Off_Location as string,\n\t\tSerivce_Tech_Market_ID as integer,\n\t\tSerivce_Tech_Market as string,\n\t\tService_Tech_Location_ID as integer,\n\t\tService_Tech_Location as string,\n\t\tCustomer_Pickup_Market_ID as integer,\n\t\tCustomer_Pickup_Market as string,\n\t\tActive_Date as date,\n\t\tDelivery_Area_Status as string,\n\t\tHashKey as string,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['Delivery_Area_ID_nk'],\n\tformat: 'table',\n\tmapColumn(\n\t\tDelivery_Area_ID_nk,\n\t\tDelivery_Area_Type_Code,\n\t\tDelivery_Area_Type,\n\t\tDelivery_Area_Short_Name,\n\t\tDelivery_Area_Name,\n\t\tDelivering_DC_ID,\n\t\tDelivering_DC,\n\t\tDrop_Off_Market_ID,\n\t\tDrop_Off_Market,\n\t\tDrop_Off_Location_ID,\n\t\tDrop_Off_Location,\n\t\tSerivce_Tech_Market_ID = Service_Tech_Market_ID,\n\t\tSerivce_Tech_Market = Service_Tech_Market,\n\t\tService_Tech_Location_ID,\n\t\tService_Tech_Location,\n\t\tCustomer_Pickup_Market_ID,\n\t\tCustomer_Pickup_Market,\n\t\tActive_Date,\n\t\tDelivery_Area_Status,\n\t\tHashKey,\n\t\tSourceSystem_fk,\n\t\tETLBatchID_Insert,\n\t\tETLBatchID_Update\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> DimDeliveryArea"
		}
	}
}