{
	"name": "df_ADLS_to_Fact_CommonFinishBridge",
	"properties": {
		"folder": {
			"name": "Fact_DataFlows"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbatrmlu",
						"type": "DatasetReference"
					},
					"name": "SourceTbatrmlu"
				},
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbatrmlv",
						"type": "DatasetReference"
					},
					"name": "SourceTbatrmlv"
				},
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbatrrel",
						"type": "DatasetReference"
					},
					"name": "SourceTbatrrel"
				},
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_Dim_SKU",
						"type": "DatasetReference"
					},
					"name": "SourceSKU"
				},
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_Dim_CommonFinish",
						"type": "DatasetReference"
					},
					"name": "SourceCommonFinish"
				},
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_Fact_CommonFinishBridge",
						"type": "DatasetReference"
					},
					"name": "SouceCommonFinishBridge"
				},
				{
					"dataset": {
						"referenceName": "ds_ADLSG2parquet_staging_masterdata_product_tbitem",
						"type": "DatasetReference"
					},
					"name": "SourceTbitem"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ds_AzureSqlTable_CommonFinishBridge",
						"type": "DatasetReference"
					},
					"name": "SinkCommonFinishBridge"
				}
			],
			"transformations": [
				{
					"name": "FilterTypeID6"
				},
				{
					"name": "SelectTbatrmlv"
				},
				{
					"name": "SelectTbatrmlu"
				},
				{
					"name": "Select1Tbatrmlu"
				},
				{
					"name": "DvClCount"
				},
				{
					"name": "LookupCommonFinish"
				},
				{
					"name": "SelectSKU"
				},
				{
					"name": "SelectCommonFinish"
				},
				{
					"name": "DvClETLETL"
				},
				{
					"name": "InnerJoinSKU"
				},
				{
					"name": "JoinTbatrrel"
				},
				{
					"name": "JoinTbatrmlu"
				},
				{
					"name": "AggDisctinctCount"
				},
				{
					"name": "WindowRemoveDuplicates"
				},
				{
					"name": "FilterRemoveDuplicates"
				},
				{
					"name": "DeriveTbatrmlv"
				},
				{
					"name": "SelectTbatrrel"
				},
				{
					"name": "Filter1TypeID9"
				},
				{
					"name": "SelectTbitem"
				},
				{
					"name": "JoinItem"
				}
			],
			"script": "parameters{\n\tMasterProcessNumber as string ('1')\n}\nsource(output(\n\t\tATRID as decimal(38,18),\n\t\tTYPEID as decimal(38,18),\n\t\tVALUE1 as string,\n\t\tVALUE2 as string,\n\t\tSEQ as decimal(38,18),\n\t\tCRTDATE as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp,\n\t\tVALUE3 as string,\n\t\tVALUE4 as string,\n\t\tVALUE5 as string,\n\t\tVALUE6 as string,\n\t\tVALUE7 as string,\n\t\tVALUE8 as string,\n\t\tVALUE9 as string,\n\t\tVALUE10 as string,\n\t\tVALUE11 as string,\n\t\tVALUE12 as string,\n\t\tVALUE13 as string,\n\t\tVALUE14 as string,\n\t\tVALUE15 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbatrmlu\nsource(output(\n\t\tATRID as decimal(38,18),\n\t\tTYPEID as decimal(38,18),\n\t\tVENDOR as string,\n\t\tVALUE1 as string,\n\t\tVALUE2 as string,\n\t\tCRTDATE as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp,\n\t\tVALUE3 as string,\n\t\tSHOWONPAGE as string,\n\t\tVALUE4 as string,\n\t\tVALUE5 as string,\n\t\tLOFTDIFREF as decimal(38,18),\n\t\tLOFTSPECRF as decimal(38,18),\n\t\tLOFTSPECNS as decimal(38,18),\n\t\tFULLRPTIMG as string,\n\t\tFULLRPTHT as decimal(38,18),\n\t\tFULLRPTWD as decimal(38,18),\n\t\tSWATCHHT as decimal(38,18),\n\t\tSWATCHWD as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbatrmlv\nsource(output(\n\t\tMAINATRID as decimal(38,18),\n\t\tRELATRID as decimal(38,18),\n\t\tMAINATRLOC as string,\n\t\tRELATRLOC as string,\n\t\tTYPE as string,\n\t\tSEQ as decimal(38,18),\n\t\tCRTDATE as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp,\n\t\tPRIMARYATR as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbatrrel\nsource(output(\n\t\tSKU_sk as integer,\n\t\tSKU_Unformatted_nk as string,\n\t\tSKU as string,\n\t\tSKU_Description as string,\n\t\tVendor_Color_ID as integer,\n\t\tVendor_Color as string,\n\t\tVendor_Color_Hex_Code as string,\n\t\tVendor_Finish_ID as integer,\n\t\tVendor_Finish as string,\n\t\tConfiguration_ID as integer,\n\t\tConfiguration as string,\n\t\tDisplay_Configuration as string,\n\t\tSize_ID as integer,\n\t\tSize as string,\n\t\tOriginal_Vendor_ID as string,\n\t\tOriginal_Vendor_sk as integer,\n\t\tCollection_ID as integer,\n\t\tCollection as string,\n\t\tGroup_ID as integer,\n\t\tGroup as string,\n\t\tProduct_ID as integer,\n\t\tProduct as string,\n\t\tReporting_Class_Code as string,\n\t\tReporting_Class as string,\n\t\tSuper_Category_ID as integer,\n\t\tSuper_Category as string,\n\t\tCategory_ID as integer,\n\t\tCategory as string,\n\t\tSub_Category_ID as integer,\n\t\tSub_Category as string,\n\t\tCurrent_EDLP_Price as decimal(10,4),\n\t\tGood_Better_Best_Category as string,\n\t\tGBB_Price_Point as string,\n\t\tMotion as string,\n\t\tDining_Style as string,\n\t\tBedroom_Style as string,\n\t\tStandalone_bed as string,\n\t\tSKU_Type as string,\n\t\tStocked as string,\n\t\tType_of_SKU as string,\n\t\tVendor as string,\n\t\tVendor_fk as integer,\n\t\tFactory as string,\n\t\tFactory_fk as integer,\n\t\tSpecial_Order_Available as string,\n\t\tVendor_Lead_Time as integer,\n\t\tProduct_Lead_Time as integer,\n\t\tGroup_Active_Start as date,\n\t\tGroup_Active_End as date,\n\t\tSKU_Flow_StartDate as date,\n\t\tSKU_Flow_EndDate as date,\n\t\tStocked_at_EDC as integer,\n\t\tStocked_at_WDC as integer,\n\t\tStocked_at_FDC as integer,\n\t\tGroup_Web_Status as integer,\n\t\tSKU_Web_Status as integer,\n\t\tMerchandising_Approval as string,\n\t\tMarketing_Approval as string,\n\t\tLineup_Status as string,\n\t\tAvailable_to_Purchase as string,\n\t\tShip_Length as integer,\n\t\tShip_Width as integer,\n\t\tShip_Height as integer,\n\t\tLength as integer,\n\t\tWidth as integer,\n\t\tHeight as integer,\n\t\tWeight as decimal(5,1),\n\t\tPrep_Cubes as decimal(5,1),\n\t\tCubes as decimal(5,1),\n\t\tPrep_Flag as string,\n\t\tAssembly_Required as string,\n\t\tAssembly_Time as decimal(4,1),\n\t\tLeave_in_Box as string,\n\t\tManufacturer_ID as string,\n\t\tUPC as long,\n\t\tHTS_Number as long,\n\t\tOriginal_SKU as string,\n\t\tRepresentative_Item as string,\n\t\tGroup_Rating_Count as integer,\n\t\tProduct_Rating_Count as integer,\n\t\tGroup_Star_Rating as decimal(6,4),\n\t\tProduct_Star_Rating as decimal(6,4),\n\t\tMade_in_ID as integer,\n\t\tMade_in_City as string,\n\t\tMade_in_State as string,\n\t\tMade_in_Country as string,\n\t\tOrigin_ID as integer,\n\t\tOrigin_City as string,\n\t\tOrigin_State as string,\n\t\tOrigin_Country as string,\n\t\tCopy as string,\n\t\tWeb_Description as string,\n\t\tPrice_Tag_Description as string,\n\t\tPrimary_Common_Color as string,\n\t\tPrimary_Common_Finish as string,\n\t\tFloor_Sample_Bedding as string,\n\t\tEmployee_Bedding as string,\n\t\tAccessory_Story as string,\n\t\t{3D_Model_Required} as string,\n\t\t{3D_Model} as string,\n\t\tScene_7_Image_URL as string,\n\t\t{Havertys.com_URL} as string,\n\t\tAdvertised_Price as decimal(7,2),\n\t\tHashKey as string,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SourceSKU\nsource(output(\n\t\tCommon_Finish_sk as integer,\n\t\tCommon_Finish_Code_nk as integer,\n\t\tCommon_Finish_Name as string,\n\t\tHashKey as string,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SourceCommonFinish\nsource(output(\n\t\tCommon_Finish_Bridge_sk as integer,\n\t\tCount as integer,\n\t\tSKU_fk as integer,\n\t\tCommon_Finish_fk as integer,\n\t\tCommon_Finish_Code_nk as integer,\n\t\tSKU_Unformatted_nk as integer,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SouceCommonFinishBridge\nsource(output(\n\t\tITEM as string,\n\t\tVENDOR as string,\n\t\tORIGVND as string,\n\t\tCRTDATE as timestamp,\n\t\tUPDATED as timestamp,\n\t\tSYNCHED as timestamp,\n\t\tSTOCKED as string,\n\t\tSKUTYPE as string,\n\t\tRPTCLASS as string,\n\t\tDESC as string,\n\t\tMFGID as string,\n\t\tCOLOR as string,\n\t\tGROUPID as decimal(38,18),\n\t\tWIDTH as decimal(38,18),\n\t\tLENGTH as decimal(38,18),\n\t\tHEIGHT as decimal(38,18),\n\t\tSKUREL as string,\n\t\tPRINTOPT as string,\n\t\tWEIGHT as decimal(38,18),\n\t\tTAXABLE as string,\n\t\tPMAMOUNT as decimal(38,18),\n\t\tTAGDESC as string,\n\t\tSETUPTIME as decimal(38,18),\n\t\tMINPRICE as decimal(38,18),\n\t\tVENDORDEF as string,\n\t\tREORDERPT as decimal(38,18),\n\t\tREORDERQTY as decimal(38,18),\n\t\tSEQUENCE as decimal(38,18),\n\t\tFLOWSTR as timestamp,\n\t\tFLOWEND as timestamp,\n\t\tCUBES as decimal(38,18),\n\t\tPTAGDESCUP as timestamp,\n\t\tHIDEORSHOW as string,\n\t\tWEBDESC as string,\n\t\tPRODID as decimal(38,18),\n\t\tDIRECTSHIP as string,\n\t\tWEBSTATUS as decimal(38,18),\n\t\tINCOMCAT as string,\n\t\tPROTECTION as decimal(38,18),\n\t\tATRID02 as decimal(38,18),\n\t\tATRID03 as decimal(38,18),\n\t\tATRID09 as decimal(38,18),\n\t\tATRID12 as decimal(38,18),\n\t\tALTDLV as string,\n\t\tSHIPWIDTH as decimal(38,18),\n\t\tSHIPLENGTH as decimal(38,18),\n\t\tSHIPHEIGHT as decimal(38,18),\n\t\tPREPCUBES as decimal(38,18),\n\t\tREPORTSKU as string,\n\t\tHTSNUMBER as decimal(38,18),\n\t\tGNRSUBFLG as string,\n\t\tUNTSPERPKG as decimal(38,18),\n\t\tMINORDQTY as decimal(38,18),\n\t\tSTRVWMRKDN as string,\n\t\tFCTSTREAM as decimal(38,18),\n\t\tUPCCODE as decimal(38,18),\n\t\tVNDITEMID as string,\n\t\tADVPRICE as decimal(38,18),\n\t\tSTORESTKD as string,\n\t\tDIAMETER as decimal(38,18),\n\t\tARMHEIGHT as decimal(38,18),\n\t\tSEATHEIGHT as decimal(38,18),\n\t\tSEATDEPTH as decimal(38,18),\n\t\tINSIDEWDTH as decimal(38,18),\n\t\tINSIDEDPTH as decimal(38,18),\n\t\tLINEUPSTAT as string,\n\t\tITEMTYPE as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SourceTbitem\nSourceTbatrmlu filter(TYPEID==6) ~> FilterTypeID6\nFilter1TypeID9 select(mapColumn(\n\t\tATRID,\n\t\tTYPEID,\n\t\tVENDOR,\n\t\tVendorfinish = VALUE1,\n\t\tVALUE2,\n\t\tCRTDATE,\n\t\tUPDATED,\n\t\tSYNCHED,\n\t\tVALUE3,\n\t\tSHOWONPAGE,\n\t\tVALUE4,\n\t\tVALUE5,\n\t\tLOFTDIFREF,\n\t\tLOFTSPECRF,\n\t\tLOFTSPECNS,\n\t\tFULLRPTIMG,\n\t\tFULLRPTHT,\n\t\tFULLRPTWD,\n\t\tSWATCHHT,\n\t\tSWATCHWD\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectTbatrmlv\nFilterTypeID6 select(mapColumn(\n\t\tATRID,\n\t\tTYPEID,\n\t\tCommonFinish = VALUE1,\n\t\tVALUE2,\n\t\tSEQ,\n\t\tCRTDATE,\n\t\tUPDATED,\n\t\tSYNCHED,\n\t\tVALUE3,\n\t\tVALUE4,\n\t\tVALUE5,\n\t\tVALUE6,\n\t\tVALUE7,\n\t\tVALUE8,\n\t\tVALUE9,\n\t\tVALUE10,\n\t\tVALUE11,\n\t\tVALUE12,\n\t\tVALUE13,\n\t\tVALUE14,\n\t\tVALUE15\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectTbatrmlu\nJoinTbatrmlu select(mapColumn(\n\t\tVendorfinish,\n\t\tCommonFinish,\n\t\t{Vendor ID} = SelectTbatrmlv@ATRID,\n\t\tITEM,\n\t\tATRID = SelectTbatrmlu@ATRID\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> Select1Tbatrmlu\nAggDisctinctCount derive(Count = 1) ~> DvClCount\nSelectSKU, SourceCommonFinish lookup(ATRID == Common_Finish_Code_nk,\n\tmultiple: true,\n\tbroadcast: 'none')~> LookupCommonFinish\nInnerJoinSKU select(mapColumn(\n\t\tVendorfinish,\n\t\tCommonFinish,\n\t\tSKU_sk,\n\t\tSKU_Unformatted_nk,\n\t\tCount,\n\t\tATRID\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectSKU\nLookupCommonFinish select(mapColumn(\n\t\tSKU_sk,\n\t\tCount,\n\t\tSKU_Unformatted_nk,\n\t\tCommon_Finish_sk,\n\t\tCommon_Finish_Code_nk,\n\t\tATRID\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SelectCommonFinish\nSelectCommonFinish derive(ETLBatchID_Insert = toInteger($MasterProcessNumber),\n\t\tETLBatchID_Update = toInteger($MasterProcessNumber),\n\t\tSourceSystem_fk = 0,\n\t\tCommon_Finish_sk = case(isNull(ATRID), -1, isNull(Common_Finish_sk) && not(isNull(ATRID)), 0, Common_Finish_sk),\n\t\tCommon_Finish_Code_nk = case(isNull(ATRID), -1, isNull(Common_Finish_Code_nk) && not(isNull(ATRID)), 0, Common_Finish_Code_nk),\n\t\tSKU_sk = iifNull(SKU_sk, 0),\n\t\tSKU_Unformatted_nk = iifNull(toInteger(SKU_Unformatted_nk), 0)) ~> DvClETLETL\nDvClCount, SourceSKU join(ITEM == SKU_Unformatted_nk,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> InnerJoinSKU\nJoinItem, SourceTbatrrel join(ATRID == MAINATRID,\n\tjoinType:'left',\n\tbroadcast: 'none')~> JoinTbatrrel\nJoinTbatrrel, SelectTbatrmlu join(RELATRID == SelectTbatrmlu@ATRID,\n\tjoinType:'left',\n\tbroadcast: 'none')~> JoinTbatrmlu\nSelect1Tbatrmlu aggregate(groupBy(Vendorfinish,\n\t\tCommonFinish,\n\t\tITEM,\n\t\tATRID),\n\tCountAgg = count(Vendorfinish)) ~> AggDisctinctCount\nDvClETLETL window(over(SKU_Unformatted_nk,\n\t\tCommon_Finish_Code_nk),\n\tasc(SKU_Unformatted_nk, true),\n\tasc(Common_Finish_Code_nk, true),\n\tDupeRows = rowNumber()) ~> WindowRemoveDuplicates\nWindowRemoveDuplicates filter(DupeRows==1) ~> FilterRemoveDuplicates\nSelectTbatrmlv derive(VALUE2 = trim(VALUE2)) ~> DeriveTbatrmlv\nSourceTbatrrel select(mapColumn(\n\t\tMAINATRID,\n\t\tRELATRID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectTbatrrel\nSourceTbatrmlv filter(TYPEID==9) ~> Filter1TypeID9\nSourceTbitem select(mapColumn(\n\t\tITEM,\n\t\tATRID09\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectTbitem\nSelectTbitem, DeriveTbatrmlv join(ATRID09 == ATRID,\n\tjoinType:'left',\n\tbroadcast: 'none')~> JoinItem\nFilterRemoveDuplicates sink(input(\n\t\tCommon_Finish_Bridge_sk as integer,\n\t\tCount as integer,\n\t\tSKU_fk as integer,\n\t\tCommon_Finish_fk as integer,\n\t\tCommon_Finish_Code_nk as integer,\n\t\tSKU_Unformatted_nk as integer,\n\t\tSourceSystem_fk as integer,\n\t\tETLBatchID_Insert as integer,\n\t\tETLBatchID_Update as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\ttruncate:true,\n\tformat: 'table',\n\tmapColumn(\n\t\tCount,\n\t\tSKU_fk = SKU_sk,\n\t\tCommon_Finish_fk = Common_Finish_sk,\n\t\tCommon_Finish_Code_nk,\n\t\tSKU_Unformatted_nk,\n\t\tSourceSystem_fk,\n\t\tETLBatchID_Insert,\n\t\tETLBatchID_Update\n\t)) ~> SinkCommonFinishBridge"
		}
	}
}