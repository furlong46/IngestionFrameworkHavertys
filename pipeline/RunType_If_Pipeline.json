{
	"name": "RunType_If_Pipeline",
	"properties": {
		"description": "This pipeline is used to copy data from DB2 to Azure Data Lake for both Staging and Raw storage. Several stored procedures are called to update logging and return metadata for the data that needs to be copied.",
		"activities": [
			{
				"name": "RunType_Condition",
				"type": "IfCondition",
				"dependsOn": [],
				"userProperties": [],
				"typeProperties": {
					"expression": {
						"value": "@equals(pipeline().parameters.RunType, 'N')",
						"type": "Expression"
					},
					"ifFalseActivities": [
						{
							"name": "SP_MasterJobEnd_Success",
							"description": "This stored procedure receives the MasterProcessNumber as input and updates the status of the MasterJob table after successful execution of previous steps.",
							"type": "SqlServerStoredProcedure",
							"dependsOn": [
								{
									"activity": "Override_Execute_pl_DB2ControledMetadata",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"policy": {
								"timeout": "7.00:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"storedProcedureName": "[dbo].[usp_MasterJobEnd_Success]",
								"storedProcedureParameters": {
									"MasterProcessNumber": {
										"value": {
											"value": "@pipeline().parameters.MasterProcessNumber",
											"type": "Expression"
										},
										"type": "Int32"
									}
								}
							}
						},
						{
							"name": "Override_Execute_pl_DB2ControledMetadata",
							"description": "This pipeline LooksUp the metadata for the DB2controlled tables to be copied, copies data from DB2 to Azure Data Lake (Raw and Staging) and logs details at the Table level.",
							"type": "ExecutePipeline",
							"dependsOn": [],
							"userProperties": [],
							"typeProperties": {
								"pipeline": {
									"referenceName": "ETL_Override_pl_DB2Controlled_Subpipeline",
									"type": "PipelineReference"
								},
								"waitOnCompletion": true,
								"parameters": {
									"MasterProcessNumber": {
										"value": "@pipeline().parameters.MasterProcessNumber",
										"type": "Expression"
									},
									"JobConfiguration": {
										"value": "@pipeline().parameters.JobConfiguration",
										"type": "Expression"
									},
									"JobParallelism": {
										"value": "@pipeline().parameters.JobParallelism",
										"type": "Expression"
									}
								}
							}
						},
						{
							"name": "SP_MasterJobEnd_Failure_DB2",
							"description": "This stored procedure receives the MasterProcessNumber as input and updates the status of the MasterJob table after failed execution of previous steps.",
							"type": "SqlServerStoredProcedure",
							"dependsOn": [
								{
									"activity": "Override_Execute_pl_DB2ControledMetadata",
									"dependencyConditions": [
										"Failed"
									]
								}
							],
							"policy": {
								"timeout": "7.00:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"storedProcedureName": "[dbo].[usp_MasterJobEnd_Failure]",
								"storedProcedureParameters": {
									"MasterProcessNumber": {
										"value": {
											"value": "@pipeline().parameters.MasterProcessNumber",
											"type": "Expression"
										},
										"type": "Int32"
									}
								}
							}
						}
					],
					"ifTrueActivities": [
						{
							"name": "Nightly_SP_MasterJobEnd_Success",
							"description": "This stored procedure receives the MasterProcessNumber as input and updates the status of the MasterJob table after successful execution of previous steps.",
							"type": "SqlServerStoredProcedure",
							"dependsOn": [
								{
									"activity": "Nightly_Execute_pl_DB2ControledMetadata",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"policy": {
								"timeout": "7.00:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"storedProcedureName": "[dbo].[usp_MasterJobEnd_Success]",
								"storedProcedureParameters": {
									"MasterProcessNumber": {
										"value": {
											"value": "@pipeline().parameters.MasterProcessNumber",
											"type": "Expression"
										},
										"type": "Int32"
									}
								}
							}
						},
						{
							"name": "Nightly_SP_MasterJobEnd_Failure_DB2",
							"description": "This stored procedure receives the MasterProcessNumber as input and updates the status of the MasterJob table after failed execution of previous steps.",
							"type": "SqlServerStoredProcedure",
							"dependsOn": [
								{
									"activity": "Nightly_Execute_pl_DB2ControledMetadata",
									"dependencyConditions": [
										"Failed"
									]
								}
							],
							"policy": {
								"timeout": "7.00:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"storedProcedureName": "[dbo].[usp_MasterJobEnd_Failure]",
								"storedProcedureParameters": {
									"MasterProcessNumber": {
										"value": {
											"value": "@pipeline().parameters.MasterProcessNumber",
											"type": "Expression"
										},
										"type": "Int32"
									}
								}
							}
						},
						{
							"name": "Nightly_Execute_pl_DB2ControledMetadata",
							"description": "This pipeline LooksUp the metadata for the DB2controlled tables to be copied, copies data from DB2 to Azure Data Lake (Raw and Staging) and logs details at the Table level.",
							"type": "ExecutePipeline",
							"dependsOn": [],
							"userProperties": [],
							"typeProperties": {
								"pipeline": {
									"referenceName": "ETL_Nightly_pl_DB2Controlled_Subpipeline",
									"type": "PipelineReference"
								},
								"waitOnCompletion": true,
								"parameters": {
									"MasterProcessNumber": {
										"value": "@pipeline().parameters.MasterProcessNumber",
										"type": "Expression"
									},
									"JobConfiguration": {
										"value": "@pipeline().parameters.JobConfiguration",
										"type": "Expression"
									},
									"JobParallelism": {
										"value": "@pipeline().parameters.JobParallelism",
										"type": "Expression"
									}
								}
							}
						}
					]
				}
			}
		],
		"parameters": {
			"JobConfiguration": {
				"type": "string",
				"defaultValue": "NightlyLoad"
			},
			"RunType": {
				"type": "string",
				"defaultValue": "N"
			},
			"MasterProcessNumber": {
				"type": "int",
				"defaultValue": 1
			},
			"JobParallelism": {
				"type": "int",
				"defaultValue": 10
			}
		},
		"folder": {
			"name": "MasterPipeline"
		},
		"annotations": []
	}
}